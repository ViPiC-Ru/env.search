/* 1.2.1 ищет данне для переменных среды

cscript env.search.min.js [<mode> [<container>]] [<option>...] [<input>...] \\ [<action>...]

<mode>      - Режим поиска данных для переменных среды.
    folder  - Получение данных из папки с ini файлами.
    ldap    - Получение данных из active directory.
<container> - Путь к папки или guid (допускается пустое значение).
<option>    - Дополнительные опции (может быть несколько, порядок не важен).
    search  - Поисковой запрос (можно опустить, будет запрошен в процессе).
    index   - Номер компьютера в выборке (можно опустить, будет запрошен в процессе).
    action  - Ключ действия (можно опустить, будет запрошен в процессе).
    item    - Шаблон представления компьютеров в выборке (доступны переменные).
    unit    - Шаблон представления других списков (доступны переменные).
    service - Имя службы, которую нужно запустить перед выполнением команды действия.
    check   - Флаг проверки доступности целевых компьютеров.
    user    - Флаг запроса информации по пользователю (только для режима ldap).
    noalign - Флаг запрета выравнивания выборок и списков.
    nowait  - Флаг выполнения действия без ожидания (только при отсутствии service).
    color   - Флаг использования цветового оформления.
<input>     - Шаблоны для получения данных из свойств компьютера (только для режима ldap).
<action>    - Действия в формате ключ и команда (доступны переменные).

*/

// 0.3.16 конструктор основного приложения
function App(a){this.val=a};

// 0.2.1 библиотека функций общего назначения
(function(q,D){q.lib={strFirstUpperCase:function(a){return a.substr(0,1).toUpperCase()+a.substr(1)},clone:function(a){switch(!0){case q.lib.validate(a,"date"):var b=new Date(a);break;case q.lib.validate(a,"array"):b=[];for(var c=0,e=a.length;c<e;c++)b[c]=q.lib.clone(a[c]);break;case q.lib.validate(a,"object"):b={};for(c in a)b[c]="prototype"!==c?q.lib.clone(a[c]):a[c];break;default:b=a}return b},compare:function(a,b,c){var e=0;b||(b=null);switch(!0){case q.lib.validate(a,"string"):b=q.lib.convert(b,
"string");c&&(a=a.toLowerCase(),b=b.toLowerCase());break;case q.lib.validate(a,"array"):b=b&&b.length?b.length:0;a=a.length;break;case q.lib.validate(a,"date"):b=b&&b.valueOf()?b.valueOf():0,a=a.valueOf()}a>b&&(e=1);a<b&&(e=-1);return e},difference:function(a,b,c){var e;c||(c=q.lib.compare);if(q.lib.validate(a,"array")){b||(b=[]);for(var d=0,f=a.length;d<f;d++){var n=a[d];for(var g=0,h=b.length;g<h;g++){var m=b[g];if(value=c(n,m))e||(e=[]),e.push(n)}}}else if(q.lib.validate(a,"object"))for(d in b||
(b={}),a)n=a[d],m=b[d],value=q.lib.difference(n,m,c),q.lib.validate(value,"undefined")||(e||(e={}),e[d]=value);else(value=q.lib.compare(a,b))&&(e=a);return e},strim:function(a,b,c,e,d){var f="";a=a?a.toString():f;b=b?b.toString():f;c=c?c.toString():f;if(d){var n=c?a.lastIndexOf(c):a.length;d=b&&~n?a.lastIndexOf(b,n-1):0}else d=b?a.indexOf(b):0,n=c&&~d?a.indexOf(c,d+b.length):a.length;~d&&~n&&(d=e?d:d+b.length,n=e?n+c.length:n,f=a.substr(d,n-d));return f},trim:function(a){return(a||"").replace(/^\s+|\s+$/g,
"")},validate:function(a,b){var c;switch(b){case "email":b="^([a-z0-9_-]+.)*[a-z0-9_-]+@[a-z0-9_-]+(.[a-z0-9_-]+)*.[a-z]{2,6}$";break;case "password":b="(?=^.{8,}$)((?=.*d)|(?=.*W+))(?![.\n])(?=.*[A-Z])(?=.*[a-z]).*$";break;case "guid":b="^{[0-9a-fA-F]{8}(-[0-9a-fA-F]{4}){3}-[0-9a-fA-F]{12}}$";break;case "md5":b="^[0-9a-fA-F]{32}$"}switch(b){case "string":a="[object String]"===Object.prototype.toString.call(a);break;case "number":a="[object Number]"===Object.prototype.toString.call(a);break;case "boolean":a=
"[object Boolean]"===Object.prototype.toString.call(a);break;case "function":a="[object Function]"===Object.prototype.toString.call(a);break;case "form":a=!(!a||!a.tagName||"form"!==a.tagName.toLowerCase());break;case "files":a="[object FileList]"===Object.prototype.toString.call(a);break;case "date":a="[object Date]"===Object.prototype.toString.call(a);break;case "array":a=Array.isArray?Array.isArray(a):"[object Array]"===Object.prototype.toString.call(a);break;case "xml":a=!(!a||!(c=(a.ownerDocument||
a).documentElement)||"html"===c.nodeName.toLowerCase());break;case "undefined":a=void 0===a;break;case "null":a=null===a;break;case "object":a=a===Object(a)&&"[object Null]"!==Object.prototype.toString.call(a)&&"[object Date]"!==Object.prototype.toString.call(a)&&"[object Function]"!==Object.prototype.toString.call(a)&&"[object FileList]"!==Object.prototype.toString.call(a)&&"[object Array]"!==Object.prototype.toString.call(a)&&!(a&&(c=(a.ownerDocument||a).documentElement)&&"html"!==c.nodeName.toLowerCase())&&
!(a&&a.tagName&&"form"===a.tagName.toLowerCase());break;default:a=(new RegExp(b)).test(""+a)}return a},obj2str:function(a,b,c,e,d){var f=[];c||(c="&");e||(e="=");d||(d=",");for(var n in a){var g=a[n];var h=b?encodeURIComponent(n):n;switch(!0){case q.lib.validate(g,"array"):g=g.join(d);case !q.lib.validate(g,"undefined"):h+=e,h+=b?encodeURIComponent(g):g}f.push(h)}return f.join(c)},str2obj:function(a,b,c,e){var d,f={};c||(c="&");e||(e="=");c=a.split(c);for(var n=0,g=c.length;n<g;n++)if(d=c[n])d=d.split(e,
2),a=d[0],d=d[1],a=b?decodeURIComponent(a):a,d=b&&d?decodeURIComponent(d):d,f[a]=d;return f},url2obj:function(a){var b=a,c={},e=!1;a="fragment";var d="#";-1!=b.indexOf(d)&&(c[a]=q.lib.strim(b,d,null,!1),b=q.lib.strim(b,null,d,!1));a="query";d="?";-1!=b.indexOf(d)&&(c[a]=q.lib.strim(b,d,null,!1),b=q.lib.strim(b,null,d,!1));a="scheme";d="//";0==b.indexOf(d)&&(c[a]=q.lib.strim(b,null,d,!1),b=q.lib.strim(b,d,null,!1),e=!0);a="path";d="/";b.indexOf("://")>b.indexOf(d)&&(c[a]=q.lib.strim(b,d,null,!0),b=
q.lib.strim(b,null,d,!1));a="path";d="://";0==b.indexOf(d)&&(c[a]=q.lib.strim(b,d,null,!0),b=q.lib.strim(b,null,d,!1));a="scheme";d="://";!e&&0<b.indexOf(d)&&(c[a]=q.lib.strim(b,null,d,!1),b=q.lib.strim(b,d,null,!1),e=!0);a="path";d="/";e&&-1!=b.indexOf(d)&&(c[a]=q.lib.strim(b,d,null,!0),b=q.lib.strim(b,null,d,!1));a="path";d=b.length;!e&&0<d&&(c[a]=b,b="");d="@";if(-1!=b.indexOf(d)){var f=q.lib.strim(b,d,null,!1);b=q.lib.strim(b,null,d,!1);a="password";d=":";-1!=b.indexOf(d)&&(c[a]=q.lib.strim(b,
d,null,!1),b=q.lib.strim(b,null,d,!1));c.user=b;b=f}a="port";d=":";-1!=b.indexOf(d)&&(c[a]=q.lib.strim(b,d,null,!1),b=q.lib.strim(b,null,d,!1));e&&(c.domain=b);return c},obj2url:function(a){var b="";"user"in a&&(b="//");"password"in a&&(b="//");"domain"in a&&(b="//");"port"in a&&(b="//");var c="scheme";a[c]&&(b="://");var e=""+((a[c]?a[c]:"")+b);c="user";c in a&&(e+=""+a[c]);c="password";c in a&&(e+=":"+a[c]);b="";"user"in a&&(b="@");"password"in a&&(b="@");c="domain";e+=b+(a[c]?a[c]:"");c="port";
c in a&&(e+=":"+a[c]);c="path";c in a&&(e+=""+a[c]);c="query";c in a&&(e+="?"+a[c]);c="fragment";c in a&&(e+="#"+a[c]);return e},data2obj:function(a){var b={};a=a.split("\r\n");var c=a.shift().split("\t");for(var e=0;e<c.length;e++)c[e]=c[e].split(":"),c[e]={name:c[e][0],type:c[e][1]};e=0;for(var d=a.length;e<d;e++){var f=a[e].split("\t",c.length);var n={};for(var g=0;g<f.length;g++)n[c[g].name]=q.lib.convert(f[g],c[g].type);c[0]&&(b[n[c[0].name]]=n)}return b},obj2data:function(a){var b=[],c=[];split=
"\t";delim="\r\n";param=":";none=" ";for(var e in a){if(!b.length){var d=[];for(h in a[e]){var f=a[e][h];f="id"==h?"integer":q.lib.validate(f,"number")?"float":q.lib.validate(f,"boolean")?"boolean":q.lib.validate(f,"date")?"date":"string";b["id"==h?0:b.length]={name:h,type:f};d[d.length]=h+param+f}c[c.length]=d.join(split)}d=[];for(var n=0,g=b.length;n<g;n++){var h=b[n].name;f=a[e][h];for(f=q.lib.convert(f,"string");-1!=f.indexOf(split);)f=f.replace(split,none);for(;-1!=f.indexOf(delim);)f=f.replace(delim,
none);f=f.replace(/[\t\r\n]/g,none);d[d.length]=f}c[c.length]=d.join(split)}return c.join(delim)},obj2arr:function(a,b){var c=[];b||(b=function(f){return f});for(var e in a){var d=a[e];d=b(d,e,a);q.lib.validate(d,"undefined")||c.push(d)}return c},arr2obj:function(a,b,c){var e={};b||(b=function(h){return h});c||(c=function(h,m){return m});for(var d=0,f=a.length;d<f;d++){var n=a[d];var g=c(n,d,a);n=b(n,d,a);q.lib.validate(n,"undefined")||q.lib.validate(g,"undefined")||(e[g]=n)}return e},convert:function(a,
b){switch(b){case "bool":case "boolean":a="true"===a?!0:"false"===a?!1:!!a;break;case "int":case "integer":case "float":case "double":case "real":case "number":a=Number(a);break;case "date":a=new Date(1E3*Number(a));break;case "string":q.lib.validate(a,"boolean")?a=a?"true":"false":q.lib.validate(a,"date")?(a=a.valueOf()/1E3,a=a.toString()):a=q.lib.validate(a,"number")?a.toString():a&&a.toString?a.toString():"";break;case "auto":q.lib.validate(a,"string")&&(b=a.split('"'),3!=b.length||b[0]||b[2]||
(a=b[1]),b=a.split("'"),3!=b.length||b[0]||b[2]||(a=b[1]),q.lib.compare("true",a,!0)?q.lib.compare("false",a,!0)?q.lib.compare("null",a,!0)?a.length&&!isNaN(a)&&(a=Number(a)):a=null:a=!1:a=!0)}return a},xhr:function(a,b,c,e,d,f,n,g){var h,m=6E5,p=0;var k=h={responseText:""};var z=null;if(!p){var r=a?""+a:"get";a=r.toUpperCase();switch(a.toLowerCase()){case "get":z=!0;break;case "head":z=!0;break;case "delete":z=!0}}if(!p){var u=function(){};var v={upload:u,download:u,success:u,error:u,complete:u};
if(q.lib.validate(f,"function"))v.complete=f;else if(f)for(t in v)u=f[t],q.lib.validate(u,"function")&&(v[t]=u);f=v}if(!p){v={"X-Requested-With":"XMLHttpRequest"};if(!1===c){var t="X-Requested-With";t in v&&delete v[t]}if(q.lib.validate(c,"object"))for(t in c)switch(u=c[t],t.toLowerCase()){case "cookie":break;case "host":break;default:v[t]=u}c=v}if(!p){e=e?e:"";if(q.lib.validate(e,"form")){v={};for(var w=0,x=e.elements.length;w<x;w++)u=e.elements[w],u.name&&!u.disabled&&(t=(""+u.type).toLowerCase(),
"checkbox"==t||"radio"==t?u.checked&&(v[u.name]=u.value?u.value:!0):v[u.name]=u.files&&u.files.length?u.files:u.value?u.value:D);e=v}q.lib.validate(e,"xml")&&(z=!1,c["Content-Type"]="application/xml",e.xml?e=e.xml:(v=new XMLSerializer,e=v.serializeToString(e)));if(q.lib.validate(e,"object")){v=!1;for(t in e)if(u=e[t],q.lib.validate(u,"files")){z=!1;v=!0;break}if(v)for(t in v=new FormData,e)if(u=e[t],q.lib.validate(u,"files")){var y=e[t];w=0;for(x=y.length;w<x;w++)u=y[w],v.append(t,u)}else q.lib.validate(u,
"undefined")&&(u=""),v.append(t,u);else e=q.lib.obj2str(e,!0),!z&&e&&(c["Content-Type"]="application/x-www-form-urlencoded")}}p||(r=b?""+b:"",z&&e&&(r=r?~r.indexOf("?")?r+"&":r+"?":r+"?",r+=e,e=""),b=r);if(!p){v=null;if(!v)try{v=new XMLHttpRequest}catch(A){}if(!v)for(z="$#!&%",y=["Ms$#!&%xm$#!&%l2$#!&%.XM$#!&%LHT$#!&%TP.6.0","Ms$#!&%xm$#!&%l2$#!&%.XM$#!&%LHT$#!&%TP.3.0","Ms$#!&%xm$#!&%l2$#!&%.XM$#!&%LHT$#!&%TP","Micr$#!&%osoft$#!&%.XM$#!&%LH$#!&%TTP"],w=0,x=y.length;!v&&w<x;w++){u=y[w];r=u.split(z).join("");
try{v=new ActiveXObject(r)}catch(A){}}v?k=v:p=1}if(!p){try{m=setTimeout(function(){r=k.responseText?k.responseText:"";k.abort();f.error(r,k);f.complete(r,k)},m)}catch(A){}k.upload&&(k.upload.onprogress=function(A){A.total&&A.loaded!=A.total&&f.upload(A,k)},k.onprogress=function(A){A.total&&A.loaded!=A.total&&f.download(A,k)});k.onreadystatechange=function(A){if(4==k.readyState){try{clearTimeout(m)}catch(B){}t=k.status?k.status:200;r=k.responseText?k.responseText:"";200<=t&&300>t&&r?f.success(r,k):
f.error(r,k);f.complete(r,k)}}}if(!p)try{g?k.open(a,b,d,n,g):n?k.open(a,b,d,n):k.open(a,b,d)}catch(A){k=h,p=2}if(!p)for(t in c)r=c[t],z="; ",q.lib.validate(r,"array")&&(y=r,r=y.join(z)),k.setRequestHeader(t,r);if(!p)try{e?k.send(e):k.send()}catch(A){k=h,p=3}if(1<p)try{clearTimeout(m)}catch(A){}p&&(r="",f.error(r,k),f.complete(r,k));return k},ajax:function(a,b,c,e,d){return q.lib.xhr(a,b,c,e,!0,d)},sjax:function(a,b,c,e){return q.lib.xhr(a,b,c,e,!1)},strPad:function(a,b,c,e){var d,f=d="",n=function(g,
h){for(;f.length<h;)f+=g;return f=f.substr(0,h)};a=""+a;c=c?""+c:" ";"left"!=e&&"right"!=e&&"both"!=e&&(e="right");0<(d=b-a.length)&&("left"==e?a=n(c,d)+a:"right"==e?a+=n(c,d):"both"==e&&(d=n(c,Math.ceil(d/2)),a=(d+a+a).substr(0,b)));return a},getCookie:function(a,b){var c=document.cookie.indexOf(a+"="),e=c+a.length+1;if(!c&&a!=document.cookie.substring(0,a.length)||-1==c)return null;a=document.cookie.indexOf(";",e);-1==a&&(a=document.cookie.length);return b?decodeURIComponent(document.cookie.substring(e,
a)):unescape(document.cookie.substring(e,a))},setCookie:function(a,b,c,e,d,f,n){var g=new Date((new Date).valueOf()+c);document.cookie=a+"="+(n?encodeURIComponent(b):escape(b))+(c?";expires="+g.toGMTString():"")+(e?";path="+e:"")+(d?";domain="+d:"")+(f?";secure":"");return!0},delCookie:function(a,b,c){q.lib.getCookie(a)&&(document.cookie=a+"="+(b?";path="+b:"")+(c?";domain="+c:"")+";expires=Thu, 01-Jan-1970 00:00:01 GMT");return!0},getStorage:function(a,b){var c,e=null,d=null;if(c=window&&window.localStorage?
localStorage.getItem(a):q.lib.getCookie(a)){var f=c.indexOf("?");-1!=f&&(type=c.substr(0,f),c=c.substr(f+1));b?(c=c.split("&"),!0!==b&&(c.length=Math.min(b,c.length))):c=[c];for(var n=0,g=c.length;n<g;n++){f=c[n].indexOf("=");if(-1!=f){if(a=c[n].substr(0,f),a=decodeURIComponent(a),e=c[n].substr(f+1),!d){var h=!0;d={}}}else a=n,e=c[n],d||(h=!1,d=[]);e=decodeURIComponent(e);type&&(e=q.lib.convert(e,type));h?d[a]=e:d.push(e)}}else d=null;return b?d:e},setStorage:function(a,b){var c,e=[];var d=function(h,
m){c||(c=q.lib.validate(h,"number")?"number":q.lib.validate(h,"date")?"date":q.lib.validate(h,"boolean")?"boolean":"string");h=q.lib.convert(h,"string");h=encodeURIComponent(h);q.lib.validate(m,"undefined")?e.push(h):(m=encodeURIComponent(m),e.push(m+"="+h))};if(q.lib.validate(b,"object"))for(var f in b)d(b[f],f);else if(q.lib.validate(b,"array")){f=0;for(var n=b.length;f<n;f++)d(b[f])}else q.lib.validate(b,"null")||d(b);if(e=e.join("&"))if(e=c+"?"+e,window&&window.localStorage)try{localStorage.setItem(a,
e);var g=!0}catch(h){g=!1}else g=q.lib.setCookie(a,e,31536E7,location.pathname,document.domain);else window&&window.localStorage?(localStorage.removeItem(a),g=!0):g=q.lib.delCookie(a,location.pathname,document.domain);return g},counter:function(){var a={};return function(b,c){var e=0;q.lib.validate(b,"array")&&b.join("_");b&&(a[b]=a[b]||0,e=a[b],!1===c?delete a[b]:!0===c?a[b]++:c&&(a[b]+=c));return e}}(),on:function(){var a={};return function(b,c,e){var d,f=[],n=0;b=b.toString().split(/\s+/);for(var g=
0,h=b.length;g<h;g++)if(d=b[g])if(a[d]||(a[d]=[0]),e)if(c){a[d][c]||(a[d][c]=[]);var m=a[d][c].length;a[d][c][m]=e;a[d][0]>=c&&f.push([d,c,m]);n++}else{m=1;for(var p=a[d].length;m<p;m++)if(a[d][m])for(var k=0,z=a[d][m].length;k<z;k++)a[d][m][k]===e&&(delete a[d][m][k],n++)}else if(a[d][0]++,c=c||a[d][0],a[d][c])for(m=0;m<a[d][c].length;m++)a[d][c][m]&&f.push([d,c,m]),n++;g=0;for(h=f.length;g<h;g++)d=f[g][0],c=f[g][1],m=f[g][2],a[d]&&a[d][c]&&a[d][c][m]&&a[d][c][m].call(a[d][c][m],c);return n}}(),
href:function(a){var b=document.createElement("a");b.href=a;return b.cloneNode(!1).href},getExt:function(a){var b="";var c=(""+a).lastIndexOf(".");-1!==c&&(b=a.substr(c+1),b=b.toLowerCase());return b},md5:function(a){var b=function(t,w){var x=t&2147483648;var y=w&2147483648;var A=t&1073741824;var B=w&1073741824;t=(t&1073741823)+(w&1073741823);return A&B?t^2147483648^x^y:A|B?t&1073741824?t^3221225472^x^y:t^1073741824^x^y:t^x^y},c=function(t,w,x,y,A,B,C){t=b(t,b(b(w&x|~w&y,A),C));return b(t<<B|t>>>
32-B,w)},e=function(t,w,x,y,A,B,C){t=b(t,b(b(w&y|x&~y,A),C));return b(t<<B|t>>>32-B,w)},d=function(t,w,x,y,A,B,C){t=b(t,b(b(w^x^y,A),C));return b(t<<B|t>>>32-B,w)},f=function(t,w,x,y,A,B,C){t=b(t,b(b(x^(w|~y),A),C));return b(t<<B|t>>>32-B,w)},n=function(t){var w="",x;for(x=0;3>=x;x++){var y=t>>>8*x&255;y="0"+y.toString(16);w+=y.substr(y.length-2,2)}return w},g=[];a=function(t){t=t.replace(/\r\n/g,"\n");for(var w="",x=0;x<t.length;x++){var y=t.charCodeAt(x);128>y?w+=String.fromCharCode(y):(127<y&&
2048>y?w+=String.fromCharCode(y>>6|192):(w+=String.fromCharCode(y>>12|224),w+=String.fromCharCode(y>>6&63|128)),w+=String.fromCharCode(y&63|128))}return w}(a.toString());g=function(t){var w=t.length;var x=w+8;for(var y=16*((x-x%64)/64+1),A=Array(y-1),B,C=0;C<w;)x=(C-C%4)/4,B=C%4*8,A[x]|=t.charCodeAt(C)<<B,C++;x=(C-C%4)/4;A[x]|=128<<C%4*8;A[y-2]=w<<3;A[y-1]=w>>>29;return A}(a);var h=1732584193;var m=4023233417;var p=2562383102;var k=271733878;for(a=0;a<g.length;a+=16){var z=h;var r=m;var u=p;var v=
k;h=c(h,m,p,k,g[a+0],7,3614090360);k=c(k,h,m,p,g[a+1],12,3905402710);p=c(p,k,h,m,g[a+2],17,606105819);m=c(m,p,k,h,g[a+3],22,3250441966);h=c(h,m,p,k,g[a+4],7,4118548399);k=c(k,h,m,p,g[a+5],12,1200080426);p=c(p,k,h,m,g[a+6],17,2821735955);m=c(m,p,k,h,g[a+7],22,4249261313);h=c(h,m,p,k,g[a+8],7,1770035416);k=c(k,h,m,p,g[a+9],12,2336552879);p=c(p,k,h,m,g[a+10],17,4294925233);m=c(m,p,k,h,g[a+11],22,2304563134);h=c(h,m,p,k,g[a+12],7,1804603682);k=c(k,h,m,p,g[a+13],12,4254626195);p=c(p,k,h,m,g[a+14],17,2792965006);
m=c(m,p,k,h,g[a+15],22,1236535329);h=e(h,m,p,k,g[a+1],5,4129170786);k=e(k,h,m,p,g[a+6],9,3225465664);p=e(p,k,h,m,g[a+11],14,643717713);m=e(m,p,k,h,g[a+0],20,3921069994);h=e(h,m,p,k,g[a+5],5,3593408605);k=e(k,h,m,p,g[a+10],9,38016083);p=e(p,k,h,m,g[a+15],14,3634488961);m=e(m,p,k,h,g[a+4],20,3889429448);h=e(h,m,p,k,g[a+9],5,568446438);k=e(k,h,m,p,g[a+14],9,3275163606);p=e(p,k,h,m,g[a+3],14,4107603335);m=e(m,p,k,h,g[a+8],20,1163531501);h=e(h,m,p,k,g[a+13],5,2850285829);k=e(k,h,m,p,g[a+2],9,4243563512);
p=e(p,k,h,m,g[a+7],14,1735328473);m=e(m,p,k,h,g[a+12],20,2368359562);h=d(h,m,p,k,g[a+5],4,4294588738);k=d(k,h,m,p,g[a+8],11,2272392833);p=d(p,k,h,m,g[a+11],16,1839030562);m=d(m,p,k,h,g[a+14],23,4259657740);h=d(h,m,p,k,g[a+1],4,2763975236);k=d(k,h,m,p,g[a+4],11,1272893353);p=d(p,k,h,m,g[a+7],16,4139469664);m=d(m,p,k,h,g[a+10],23,3200236656);h=d(h,m,p,k,g[a+13],4,681279174);k=d(k,h,m,p,g[a+0],11,3936430074);p=d(p,k,h,m,g[a+3],16,3572445317);m=d(m,p,k,h,g[a+6],23,76029189);h=d(h,m,p,k,g[a+9],4,3654602809);
k=d(k,h,m,p,g[a+12],11,3873151461);p=d(p,k,h,m,g[a+15],16,530742520);m=d(m,p,k,h,g[a+2],23,3299628645);h=f(h,m,p,k,g[a+0],6,4096336452);k=f(k,h,m,p,g[a+7],10,1126891415);p=f(p,k,h,m,g[a+14],15,2878612391);m=f(m,p,k,h,g[a+5],21,4237533241);h=f(h,m,p,k,g[a+12],6,1700485571);k=f(k,h,m,p,g[a+3],10,2399980690);p=f(p,k,h,m,g[a+10],15,4293915773);m=f(m,p,k,h,g[a+1],21,2240044497);h=f(h,m,p,k,g[a+8],6,1873313359);k=f(k,h,m,p,g[a+15],10,4264355552);p=f(p,k,h,m,g[a+6],15,2734768916);m=f(m,p,k,h,g[a+13],21,
1309151649);h=f(h,m,p,k,g[a+4],6,4149444226);k=f(k,h,m,p,g[a+11],10,3174756917);p=f(p,k,h,m,g[a+2],15,718787259);m=f(m,p,k,h,g[a+9],21,3951481745);h=b(h,z);m=b(m,r);p=b(p,u);k=b(k,v)}return(n(h)+n(m)+n(p)+n(k)).toLowerCase()},sha256:function(a){var b=function(e,d){var f=(e&65535)+(d&65535);return(e>>16)+(d>>16)+(f>>16)<<16|f&65535},c=function(e,d){return e>>>d|e<<32-d};a=function(e){e=e.replace(/\r\n/g,"\n");for(var d="",f=0;f<e.length;f++){var n=e.charCodeAt(f);128>n?d+=String.fromCharCode(n):(127<
n&&2048>n?d+=String.fromCharCode(n>>6|192):(d+=String.fromCharCode(n>>12|224),d+=String.fromCharCode(n>>6&63|128)),d+=String.fromCharCode(n&63|128))}return d}(a);return function(e){for(var d="",f=0;f<4*e.length;f++)d+="0123456789abcdef".charAt(e[f>>2]>>8*(3-f%4)+4&15)+"0123456789abcdef".charAt(e[f>>2]>>8*(3-f%4)&15);return d}(function(e,d){var f=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,
3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,
3204031479,3329325298],n=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],g=Array(64),h,m;e[d>>5]|=128<<24-d%32;e[(d+64>>9<<4)+15]=d;for(h=0;h<e.length;h+=16){d=n[0];var p=n[1];var k=n[2];var z=n[3];var r=n[4];var u=n[5];var v=n[6];var t=n[7];for(m=0;64>m;m++){if(16>m)g[m]=e[m+h];else{var w=m;var x=g[m-2];x=c(x,17)^c(x,19)^x>>>10;x=b(x,g[m-7]);var y=g[m-15];y=c(y,7)^c(y,18)^y>>>3;g[w]=b(b(x,y),g[m-16])}w=r;w=c(w,6)^c(w,11)^c(w,25);w=b(b(b(b(t,w),r&u^~r&v),f[m]),
g[m]);t=d;t=c(t,2)^c(t,13)^c(t,22);x=b(t,d&p^d&k^p&k);t=v;v=u;u=r;r=b(z,w);z=k;k=p;p=d;d=b(w,x)}n[0]=b(d,n[0]);n[1]=b(p,n[1]);n[2]=b(k,n[2]);n[3]=b(z,n[3]);n[4]=b(r,n[4]);n[5]=b(u,n[5]);n[6]=b(v,n[6]);n[7]=b(t,n[7])}return n}(function(e){for(var d=[],f=0;f<8*e.length;f+=8)d[f>>5]|=(e.charCodeAt(f/8)&255)<<24-f%32;return d}(a),8*a.length))},parseJSON:function(a){if(window&&window.JSON&&JSON.parse)try{var b=JSON.parse(a)}catch(c){b=eval("("+a+")")}else b=eval("("+a+")");return b},numDeclin:function(a,
b,c,e){a=Number(a);a=Math.abs(a);a=Math.floor(a);var d=a%10;return 1!=(a%100-d)/10?0==d?b:1==d?c:5>d?e:b:b},num2str:function(a,b,c,e){var d,f;isNaN(b=Math.abs(b))&&(b=2);c==D&&(c=",");e==D&&(e=".");if(f=0>a)a=Math.abs(a);var n=parseInt(a=(+a||0).toFixed(b))+"";var g=(d=3<(d=n.length)?d%3:0)?n.substr(0,d)+e:"";e=n.substr(d).replace(/(\d{3})(?=\d)/g,"$1"+e);a=b?c+Math.abs(a-n).toFixed(b).replace(/-/,0).slice(2):"";return(f?"-":"")+g+e+a},num2word:function(a,b,c){function e(t,w){t=t.toString().substr(-2);
return w[0]+(/^[0,2-9]?[1]$/.test(t)?w[2]:/^[0,2-9]?[2-4]$/.test(t)?w[3]:w[1])}var d=[],f=[["ноль"],[,,,"три","четыре","пять","шесть","семь","восемь","девять"],"десять одиннадцать двенадцать тринадцать четырнадцать пятнадцать шестнадцать семнадцать восемнадцать девятнадцать".split(" "),[,,"двадцать","тридцать","сорок","пятьдесят","шестьдесят","семьдесят","восемьдесят","девяносто"],[,"сто","двести","триста","четыреста","пятьсот","шестьсот","семьсот","восемьсот","девятьсот"],[[,"один","два"],[,"одна",
"две"],[,"одно","два"]]],n=[["...ллион","ов","","а"],["тысяч","","а","и"],["миллион","ов","","а"],["миллиард","ов","","а"],["триллион","ов","","а"],["квадриллион","ов","","а"],["квинтиллион","ов","","а"],["секстилион","ов","","а"],["септилион","ов","","а"],["окталион","ов","","а"],["ноналион","ов","","а"],["декалион","ов","","а"],["эндекалион","ов","","а"],["додекалион","ов","","а"]],g=[[["цел","ых","ый","ых"],["цел","ых","ая","ых"],["цел","ых","ое","ых"]],["десят","ых","ая","ых"],["сот","ых","ая",
"ых"],["тясячн","ых","ая","ых"],["десятитысячн","ых","ая","ых"],["стотысячн","ых","ая","ых"],["милионн","ых","ая","ых"],["десятимилионн","ых","ая","ых"]];c=c||0;a=a.toString().split(".");for(var h=0,m=a.length;h<m;h++){h&&(a[h]=a[h].substr(0,g.length-1));l=a[h].length;a[h]=["","00","0"][a[h].split(/\d{3}/).join("").length]+a[h];for(var p=a[h].length,k,z=0,r=-1,u=[];3*z<p;){k=a[h].substr(-3*(z+1),3);u[++r]=[];for(var v=0;2>=v;v++)if(0!=k[v])switch(v){case 0:u[r][u[r].length]=f[4][k[v]];break;case 1:1==
k[v]?(u[r][u[r].length]=f[2][k[2]],v=3):u[r][u[r].length]=f[3][k[v]];break;case 2:u[r][u[r].length]=2>=k[v]?f[5][1==z||h?1:c][k[v]]:f[1][k[v]]}u[r].length||(u[r][u[r].length]=f[0][0]);0<k&&0<z&&(u[r][u[r].length]=e(k,n[z]));!z&&1<m&&(u[r][u[r].length]=e(k,h?g[l]:g[0][c]));z||!b||h||h!=m-1?!z&&b&&h&&(u[r][u[r].length]=b[0]+b[3]):u[r][u[r].length]=e(k,b);u[r]=u[r].join(" ");z++}d[d.length]=u.reverse().join(" ")}return d.join(" ")},date2str:function(a,b){var c="Воскресенье Понедельник Вторник Среда Четверг Пятница Суббота".split(" "),
e=" Января Февраля Марта Апреля Мая Июня Июля Августа Сентября Октября Ноября Декабря".split(" "),d={0:"ый",2:"ой",3:"ий",6:"ой",7:"ой",8:"ой",22:"ой",26:"ой",27:"ой",28:"ой"},f={"-660":"ST","-600":"HAST","-540":"AKT","-480":"AWST","-420":"CXT","-360":"СST","-300":"EST","-240":"AST","-210":"NST","-180":"ART",0:"GMT",60:"CET",120:"CAT",180:"MSK",210:"IRST",300:"PKT",330:"IST",360:"BDT",390:"MST",420:"CXT",480:"AWST",540:"JST",570:"ACST",600:"AEST",660:"NFT"},n="";var g=function(z){var r="";switch(z){case "d":r+=
q.lib.strPad(g("j"),2,"0","left");break;case "D":r+=g("l").substr(0,3);break;case "j":r+=a.getDate();break;case "l":r+=c[g("w")];break;case "N":r+=g("w")||7;break;case "S":r+=d[g("j")]||d[0];break;case "w":r+=a.getDay();break;case "z":r+=(a-new Date(a.getFullYear(),0,1))/864E5>>0;break;case "W":z=new Date(a.valueOf());var u=(a.getDay()+6)%7;z.setDate(z.getDate()-u+3);u=z.valueOf();z.setMonth(0,1);4!==z.getDay()&&z.setMonth(0,1+(4-z.getDay()+7)%7);r+=1+Math.ceil((u-z)/6048E5);break;case "F":r+=e[g("n")];
break;case "m":r+=q.lib.strPad(g("n"),2,"0","left");break;case "M":r+=g("F").substr(0,3);break;case "n":r+=a.getMonth()+1;break;case "t":r+=(new Date(a.getFullYear(),a.getMonth()+1,0)).getDate();break;case "L":r+=a.getFullYear()&3||!(a.getFullYear()%100)&&a.getFullYear()%400?0:1;break;case "o":(function(){var v=new Date(a.valueOf());v.setDate(v.getDate()-(a.getDay()+6)%7+3);r+=v.getFullYear()})();break;case "Y":r+=a.getFullYear();break;case "y":r+=g("Y").substr(2,2);break;case "a":r+=11<a.getHours()?
"pm":"am";break;case "A":r+=g("a").toUpperCase();break;case "B":(function(){var v=60*(a.getTimezoneOffset()+60);v=3600*a.getHours()+60*a.getMinutes()+a.getSeconds()+v;v=Math.floor(v/86.4);1E3<v&&(v-=1E3);0>v&&(v+=1E3);r+=q.lib.strPad(v,3,"0","left")})();break;case "g":r+=a.getHours()%12||12;break;case "G":r+=a.getHours();break;case "h":r+=q.lib.strPad(g("g"),2,"0","left");break;case "H":r+=q.lib.strPad(g("G"),2,"0","left");break;case "i":r+=q.lib.strPad(a.getMinutes(),2,"0","left");break;case "s":r+=
q.lib.strPad(a.getSeconds(),2,"0","left");break;case "u":r+=q.lib.strPad(1E3*a.getMilliseconds(),6,"0","left");break;case "e":r+=(new Date).toString().split(" ")[5].split("-")[0].split("+")[0];break;case "I":r+=(new Date(a.getFullYear(),0,1)).getTimezoneOffset()!=a.getTimezoneOffset()?1:0;break;case "O":r+=(0<a.getTimezoneOffset()?"-":"+")+q.lib.strPad(Math.abs(a.getTimezoneOffset()/60*100),4,"0","left");break;case "P":r+=g("O").substr(0,3)+":"+g("O").substr(3,2);break;case "T":r+=f[-1*a.getTimezoneOffset()-
60*Number(g("I"))]||f[0];break;case "Z":r+=-60*a.getTimezoneOffset();break;case "c":r+=g("Y")+"-"+g("m")+"-"+g("d")+"T"+g("h")+":"+g("i")+":"+g("s")+g("P");break;case "r":r+=g("D")+", "+g("j")+" "+g("M")+" "+g("Y")+" "+g("h")+":"+g("i")+":"+g("s")+" "+g("O");break;case "U":r+=Math.round(a.getTime()/1E3)}return r};for(var h=0,m=b.length;h<m;h++){var p=b.charAt(h);n="\\"!==k?n+(g(p)||p):n+p;var k=p}return n},extend:function(){var a=arguments[0]||{},b=1,c=arguments.length,e=!1,d;q.lib.validate(a,"boolean")&&
(e=a,a=arguments[1]||{},b=2);for(q.lib.validate(a,"object")||q.lib.validate(a,"function")||(a={});b<c;++b)if(null!=(d=arguments[b]))for(var f in d){var n=a[f],g=d[f];a!==g&&(e&&g&&q.lib.validate(g,"object")&&!g.nodeType?a[f]=q.lib.extend(e,n||(null!=g.length?[]:{}),g):q.lib.validate(g,"undefined")||(a[f]=g))}return a},template:function(a,b,c){var e;if(a){b||(b={});a=a.toString();a=a.split("|");for(var d=a.length,f=d-1;-1<f;f--)if(e=a[f]){var n=!0;var g=e.split("{");for(var h=1,m=g.length;h<m;h++){e=
g[h];var p=e.indexOf("}");if(~p){var k=e.substr(0,p);var z=k.split(">");var r=z.shift().split(".");if(q.lib.validate(b,"function"))k=b(r),n=!q.lib.validate(k,"undefined");else{k=b;for(var u=0,v=r.length;n&&u<v;u++){var t=r[u];(n=t in k)&&(k=k[t])}}u=0;for(v=z.length;n&&u<v;u++)n=z[u],c?(k=c(n,k),n=!q.lib.validate(k,"undefined")):n=!1;n&&(p+=1,e=k+e.substr(p))}else e="{"+e;g[h]=e}e=g.join("");n?a[f]=e:a.splice(f,1)}else f&&f<d-1&&(a[f]="|");b=a.join("")}else b="";return b},getRandomString:function(a,
b){var c="";b||(b=89);b=Math.min(Math.max(b,1),89);for(var e=0;e<a;e++)c+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!@#$%^&*()-_+=;:,./?|`~[]{}".charAt(Math.round(Math.random()*(b-1)));return c},hasValue:function(a,b,c){var e=!1;var d=!c&&q.lib.validate(b,"string");switch(!0){case q.lib.validate(a,"array"):for(var f=0,n=a.length;f<n&&!(e=c?a[f]===b:d&&q.lib.validate(a[f],"string")?a[f].toLowerCase()==b.toLowerCase():a[f]==b);f++);break;case q.lib.validate(a,"object"):for(f in a)if(e=
c?a[f]===b:d&&q.lib.validate(a[f],"string")?a[f].toLowerCase()==b.toLowerCase():a[f]==b)break;break;case q.lib.validate(a,"string"):e=d?-1!=a.toLowerCase().indexOf(b.toLowerCase()):-1!=a.indexOf(b);break;default:e=c?a===b:a==b}return e},ini2obj:function(a,b){var c={};a=a?(""+a).split("\r\n"):"";for(var e=0,d=a.length;e<d;e++){var f=q.lib.trim(a[e]);if(f.indexOf(";")&&f.indexOf("#"))if(f.indexOf("[")||f.length!=f.indexOf("]",1)+1){if(~f.indexOf("=")){var n=q.lib.trim(q.lib.strim(f,null,"=",!1,!1));
f=q.lib.trim(q.lib.strim(f,"=",null,!1,!1));b&&(f=q.lib.convert(f,"auto"))}else n=q.lib.trim(f),f=D;g?(q.lib.validate(c[g],"object")||(c[g]={}),n&&(c[g][n]=f)):n&&(c[n]=f)}else var g=q.lib.trim(f.substr(1,f.length-1-1))}return c}}})(App.prototype);

// 0.2.1 функци для работы в среде windows script host
(function(r,u,v){r.wsh={getLDAP:function(b,c,a,d,e){var l=[],q=[],f=0;if(!f){var m=new ActiveXObject("ADODB.Connection");var t=new ActiveXObject("NameTranslate");var h=new ActiveXObject("ADODB.Command")}f||(m.provider="ADsDSOObject",d&&(m.properties("User ID").value=d),e&&(m.properties("Password").value=e),m.open("Active Directory Provider"),h.activeConnection=m,h.properties("Searchscope").value=2,h.properties("Page Size").value=100);if(!f)if(a)var n=a;else try{var g=GetObject("LDAP://RootDSE");n=
g.get("DefaultNamingContext")}catch(p){f=1}f||(q=[b],c&&q.push(c));for(d=q.length-1;!f&&-1<d;d--){b=q[d];c=g=null;e="SELECT distinguishedName FROM 'LDAP://"+n+"'";if(!f&&b&&!c&&r.lib.validate(b,"guid")){a=(""+b).toUpperCase();try{t.init(3,""),t.set(7,a),c=t.get(1)}catch(p){f=2}}if(!f&&b&&!c)try{(c=b.get("distinguishedName"))&&(g=b)}catch(p){}if(!f&&b&&!c){a=e+" WHERE name = '"+b+"' OR sAMAccountName = '"+b+"' OR distinguishedName = '"+b+"'";try{h.commandText=a;var k=h.execute();k.recordCount&&(c=
k.fields("distinguishedName").value)}catch(p){}}if(!f&&!c){b?(a=""+b,a=r.lib.template(a,{protocol:"LDAP:",parent:n,select:e}),a.toUpperCase().indexOf("WHERE")?a.toUpperCase().indexOf("SELECT")&&(f=3):a=e+" "+a):a=e+" WHERE distinguishedName = '"+n+"'";try{h.commandText=a,k=h.execute(),k.recordCount||(f=5)}catch(p){f=4}}if(!f&&c&&!d)if(g)l.push(g);else{a=c;try{g=GetObject("LDAP://"+a),l.push(g)}catch(p){f=6}}if(!f&&!c)for(b=0,e=k.recordCount;b<e;k.moveNext(),b++)a=k.fields("distinguishedName").value,
b||(c=a),!d&&a&&(g=GetObject("LDAP://"+a),l.push(g));f||(n=c)}return l},iconv:function(b,c,a){var d=new ActiveXObject("ADODB.Stream");d.type=2;d.mode=3;d.open();d.charset=c;d.writeText(a);d.position=0;d.charset=b;a=d.readText();d.close();return a},getFileText:function(b){var c="";var a=new ActiveXObject("ADODB.Stream");a.type=2;a.mode=3;a.open();try{a.loadFromFile(b),c=a.readText()}catch(d){}a.close();return c},setFileText:function(b,c,a){var d=0;var e=new ActiveXObject("ADODB.Stream");e.type=2;e.mode=
3;e.open();if(a)try{e.loadFromFile(b),e.readText(),e.writeText("\r\n")}catch(l){}try{e.writeText(c),e.saveToFile(b,2)}catch(l){d=1}e.close();return!d}}})(App.prototype,WSH);

// 0.1.0 расширяем глобальные функции среды
function setEnv(env, key, value) { env(key) = value; }

// 1.2.1 ищет данне для переменных среды
var search=new App({argWrap:'"',altWrap:"'",envWrap:"%",keyDelim:"=",putDelim:"\\\\",envType:"Process"});
(function(n,b,G){b.lib.extend(b,{fun:{translit:function(e){var l="";var q={"щ":"shch","ё":"yo","ж":"zh","ч":"ch","ш":"sh","ю":"yu","я":"ya","х":"kh","а":"a","б":"b","в":"v","г":"g","д":"d","е":"e","з":"z","и":"i","й":"j","к":"k","л":"l","м":"m","н":"n","о":"o","п":"p","р":"r","с":"s","т":"t","у":"u","ф":"f","ц":"c","ы":"y","э":"e","ъ":"","ь":""};e=e||"";for(var k=0,c=e.length;k<c;k++){var r=!1;for(var m in q)if(value=e.substr(k,m.length),r=value.toLowerCase()==m)break;r?((r=value==value.toLowerCase())?
value=q[m]:(value=e.substr(k+m.length,1),value=(r=value==value.toUpperCase())?q[m].toUpperCase():q[m].substr(0,1).toUpperCase()+q[m].substr(1)),k+=m.length-1):value=e.substr(k,1);l+=value}return l},count:function(e){var l=0;if(e)for(var q in e)l++;return l},color:function(e,l,q){l=l?""+l:"";var k=String.fromCharCode(27)+"[";switch(e){case "reset":var c=0;break;case "black":c=90;break;case "red":c=91;break;case "green":c=92;break;case "yellow":c=93;break;case "blue":c=94;break;case "purple":c=95;break;
case "cyan":c=96;break;case "white":c=97}isNaN(c)?e=l:(e=k+c+"m"+l,q||(e+=k+0+"m"));return e},getItemProperty:function(e,l){var q="";try{q=e.get(l)}catch(k){}return q},getDataPattern:function(e,l,q){var k,c=0,r={},m=0;l=l?""+l:"";e=(e?""+e:"").split(b.val.envWrap);for(var t=0,g=e.length;t<g&&!m;t++){var u=e[t];if(t%2&&t!=g-1)if(k=q?u:u.toUpperCase()){u=e[t+1];var d=u.length?l.indexOf(u,c):l.length;~d?(r[k]=l.substr(c,d-c),c=d):m=3}else m=2;else d=l.indexOf(u,c),c==d?c+=u.length:m=1}return m?{}:r},
setDataPattern:function(e,l,q){l=l||{};e=(e?""+e:"").split(b.val.envWrap);for(var k=0,c=e.length;k<c;k++)if(k%2&&k!=c-1){var r=e[k];e[k]="";for(var m in l)b.lib.compare(m,r,!q)||(e[k]=l[m])}return e.join("")}},init:function(){var e,l,q,k=[],c={},r={},m={},t=!0,g=0;var u=new ActiveXObject("WScript.Shell");var d=new ActiveXObject("Scripting.FileSystemObject");var A=new ActiveXObject("wbemScripting.Swbemlocator");A.security_.impersonationLevel=3;if(!g){var p=n.arguments.length;for(e=0;e<p;e++){var a=
n.arguments.item(e);if(!("service"in c)){var h=b.lib.strim(a,null,b.val.keyDelim,!1,!1).toLowerCase();if("service"==h){a=b.lib.strim(a,b.val.keyDelim,null,!1,!1);var f=a.split(b.val.argWrap);3!=f.length||f[0]||f[2]||(a=f[1]);c[h]=a;continue}}if(!("item"in c)&&(h=b.lib.strim(a,null,b.val.keyDelim,!1,!1).toLowerCase(),"item"==h)){a=b.lib.strim(a,b.val.keyDelim,null,!1,!1);f=a.split(b.val.argWrap);3!=f.length||f[0]||f[2]||(a=f[1]);c[h]=a;continue}if(!("unit"in c)&&(h=b.lib.strim(a,null,b.val.keyDelim,
!1,!1).toLowerCase(),"unit"==h)){a=b.lib.strim(a,b.val.keyDelim,null,!1,!1);f=a.split(b.val.argWrap);3!=f.length||f[0]||f[2]||(a=f[1]);c[h]=a;continue}if(!("search"in c)&&(h=b.lib.strim(a,null,b.val.keyDelim,!1,!1).toLowerCase(),"search"==h)){a=b.lib.strim(a,b.val.keyDelim,null,!1,!1);f=a.split(b.val.argWrap);3!=f.length||f[0]||f[2]||(a=f[1]);c[h]=a;continue}if(!("index"in c)&&(h=b.lib.strim(a,null,b.val.keyDelim,!1,!1).toLowerCase(),"index"==h)){a=b.lib.strim(a,b.val.keyDelim,null,!1,!1);f=a.split(b.val.argWrap);
3!=f.length||f[0]||f[2]||(a=f[1]);a=isNaN(a)?-1:Number(a)-1;c[h]=a;continue}if(!("action"in c)&&(h=b.lib.strim(a,null,b.val.keyDelim,!1,!1).toLowerCase(),"action"==h)){a=b.lib.strim(a,b.val.keyDelim,null,!1,!1);f=a.split(b.val.argWrap);3!=f.length||f[0]||f[2]||(a=f[1]);c[h]=a;continue}if("check"in c||b.lib.compare("check",a,!0))if("user"in c||b.lib.compare("user",a,!0))if("color"in c||b.lib.compare("color",a,!0))if("noalign"in c||b.lib.compare("noalign",a,!0))if("nowait"in c||b.lib.compare("nowait",
a,!0))if(0!=e||v||b.val.putDelim==a)if(1==e&&!w&&v&&b.val.putDelim!=a)var w=a;else break;else var v=a.toLowerCase();else c.nowait=!0;else c.noalign=!0;else c.color=!0;else c.user=!0;else c.check=!0}}"item"in c||(c.item="%NET-HOST%");"unit"in c||(c.unit="%TMP-KEY%");if(!g)for(l=!1;e<p&&!l&&!g;)a=n.arguments.item(e),b.val.putDelim!=a?(h=b.lib.strim(a,null,b.val.keyDelim,!1,!1).toLowerCase())?(a=b.lib.strim(a,b.val.keyDelim,null,!1,!1),f=a.split(b.val.argWrap),3!=f.length||f[0]||f[2]||(a=f[1]),r[h]=
a):g=1:l=!0,e++;if(!g)for(;e<p&&!g;)a=n.arguments.item(e),(h=b.lib.strim(a,null,b.val.keyDelim,!1,!1))?(a=b.lib.strim(a,b.val.keyDelim,null,!1,!1),f=a.split(b.val.argWrap),3!=f.length||f[0]||f[2]||(a=f[1]),a=a.split(b.val.altWrap).join(b.val.argWrap),m[h]=a):g=2,e++;if(!g&&v&&!("search"in c))try{n.stdOut.write("Введите поисковой запрос: "),c.color&&n.stdOut.write(b.fun.color("yellow","",!0)),a=n.stdIn.readLine(),c.color&&n.stdOut.write(b.fun.color("reset","",!0)),a=b.wsh.iconv("cp866","windows-1251",
a),c.search=a,t=!1}catch(y){try{n.stdOut.writeLine()}catch(C){}g=3}switch(v){case "folder":g||(c.unit||!b.fun.count(m))&&c.item||(g=5);!g&&(c.nowait&&(!c.nowait||c.service)||b.fun.count(r)||c.user)&&(g=6);g||(p=d.getAbsolutePathName(w),d.folderExists(p)?w=d.getFolder(p):g=7);if(!g)for(p=new Enumerator(w.files);!p.atEnd();)a=p.item(),p.moveNext(),a=b.wsh.getFileText(a.path),d=b.lib.ini2obj(a,!1),(!c.search||b.lib.hasValue(d["NET-MAC"],c.search,!1)||b.lib.hasValue(d["SYS-KEY"],c.search,!1)||b.lib.hasValue(d["NET-HOST"],
c.search,!1)||b.lib.hasValue(d["USR-NAME"],c.search,!1)||b.lib.hasValue(d["DEV-NAME"],c.search,!1)||b.lib.hasValue(d["NET-IP-V4"],c.search,!1)||b.lib.hasValue(d["SYS-VERSION"],c.search,!1)||b.lib.hasValue(d["USR-LOGIN"],c.search,!1)||b.lib.hasValue(d["DEV-DESCRIPTION"],c.search,!1)||b.lib.hasValue(d["PCB-BIOS-SERIAL"],c.search,!1)||b.lib.hasValue(d["USR-NAME"],b.fun.translit(c.search),!1))&&d["NET-HOST"]&&k.push(d);break;case "ldap":!g&&(!c.unit&&b.fun.count(m)||!c.item||w&&!b.lib.validate(w,"guid"))&&
(g=5);g||!c.nowait||c.nowait&&!c.service||(g=6);g||(w=b.wsh.getLDAP(w)[0])||(g=7);g||(q=b.wsh.getLDAP("WHERE objectClass = 'Computer'"+(c.search?" AND (name = '*"+c.search+"*' OR description = '*"+c.search+"*' OR operatingSystemVersion = '*"+c.search+"*' OR description = '*"+b.fun.translit(c.search)+"*')":""),w));if(!g)for(p=q.length,e=0;e<p;e++){f=q[e];d={};if(a=b.fun.getItemProperty(f,"cn"))d["NET-HOST"]=a;if(a=b.fun.getItemProperty(f,"distinguishedName"))d["NET-HOST-DN"]=a;if(a=b.fun.getItemProperty(f,
"operatingSystem"))d["SYS-NAME"]=a;if(a=b.fun.getItemProperty(f,"operatingSystemVersion").replace(" (",".").replace(")",""))d["SYS-VERSION"]=a;for(h in r)d=b.lib.extend(d,b.fun.getDataPattern(r[h],b.fun.getItemProperty(f,h),!1));if(c.user&&d["USR-NAME-FIRST"]&&d["USR-NAME-SECOND"]&&(f=b.wsh.getLDAP("WHERE objectClass = 'User' AND sn = '"+d["USR-NAME-FIRST"]+"' AND givenName = '"+d["USR-NAME-SECOND"]+"'",w),f.length)){f=f[0];if(a=b.fun.getItemProperty(f,"co"))d["USR-COUNTRY"]=a;if(a=b.fun.getItemProperty(f,
"c"))d["USR-COUNTRY-ID"]=a;if(a=b.fun.getItemProperty(f,"company"))d["USR-COMPANY"]=a;if(a=b.fun.getItemProperty(f,"displayName"))d["USR-NAME"]=a;if(a=b.fun.getItemProperty(f,"department"))d["USR-DEPARTMENT"]=a;if(a=b.fun.getItemProperty(f,"homeDirectory"))d["USR-HOME"]=a;if(a=b.fun.getItemProperty(f,"l"))d["USR-CITY"]=a;if(a=b.fun.getItemProperty(f,"mail"))d["USR-EMAIL"]=a;if(a=b.fun.getItemProperty(f,"mobile"))d["USR-MOBILE"]=a;if(a=b.fun.getItemProperty(f,"objectSid"))d["USR-SID"]=a;if(a=b.fun.getItemProperty(f,
"sAMAccountName"))d["USR-LOGIN"]=a;if(a=b.fun.getItemProperty(f,"distinguishedName"))d["USR-ACCOUNT-DN"]=a;if(a=b.fun.getItemProperty(f,"telephoneNumber"))d["USR-PHONE"]=a;if(a=b.fun.getItemProperty(f,"title"))d["USR-POSITION"]=a;if(a=b.fun.getItemProperty(f,"info"))d["USR-INFO"]=a}d["NET-HOST"]&&k.push(d)}break;default:!g&&v&&(g=4),g||b.fun.count(m)&&c.unit||(g=5),!g&&(b.fun.count(r)||"search"in c||"index"in c||c.service||c.check||c.user)&&(g=6)}g||!v||k.length||(g=8);if(k.length){if(c.check){if(!g)try{var F=
A.connectServer("","root\\CIMV2")}catch(y){g=9}if(!g)for(p=k.length,e=0;e<p;e++)for(d=k[e],v=F.execQuery("SELECT responseTime, statusCode FROM Win32_PingStatus WHERE address = '"+d["NET-HOST"]+"' AND timeout = 600"),v=new Enumerator(v);!v.atEnd();){f=v.item();v.moveNext();0==f.statusCode&&(d["TMP-CHECK"]=f.responseTime+" мс");break}}if(!g){var x={};p=k.length;for(e=0;e<p;e++)if(d=k[e],d["TMP-INDEX"]=b.lib.strPad(e+1,(""+p).length,"0","left"),!c.noalign)for(h in d)x[h]=Math.max(d[h].length,x[h]||0)}if(!g){p=
k.length;t||n.stdOut.writeLine();for(e=0;e<p;e++){d=k[e];d=b.lib.clone(d);if(!c.noalign)for(h in x)d[h]=b.lib.strPad(d[h]||"",x[h]," ",isNaN(b.lib.trim(d[h]).charAt(0))?"right":"left");if(a=d["TMP-INDEX"])d["TMP-INDEX"]=b.fun.color(c.color?"yellow":null,a);if(a=d["NET-HOST"])d["NET-HOST"]=b.fun.color(c.color?"cyan":null,a);a=b.fun.setDataPattern(c.item,d,!1);n.stdOut.writeLine(a)}b.fun.count(m)&&n.stdOut.writeLine();t=!0}}f=null;if(b.fun.count(m)){if(k.length){if(!(g||"index"in c))try{n.stdOut.write("Введите номер компьютера: "),
c.color&&n.stdOut.write(b.fun.color("yellow","",!0)),a=n.stdIn.readLine(),c.color&&n.stdOut.write(b.fun.color("reset","",!0)),a=b.wsh.iconv("cp866","windows-1251",a),a=isNaN(a)?-1:Number(a)-1,c.index=a,t=!1}catch(y){try{n.stdOut.writeLine()}catch(C){}g=10}g||(f=k[c.index])||(g=11);if(!g)for(h in d=f,k=u.environment(b.val.envType),d)a=d[h],setEnv(k,h,a)}if(!g){var B=[];x={};e=0;p=b.fun.count(m);for(h in m){d={};d["TMP-KEY"]=h;d["TMP-VALUE"]=u.expandEnvironmentStrings(m[h]);d["TMP-INDEX"]=b.lib.strPad(e+
1,(""+p).length,"0","left");if(!c.noalign)for(h in d)x[h]=Math.max(d[h].length,x[h]||0);B.push(d);e++}}if(!g){p=B.length;t||n.stdOut.writeLine();for(e=0;e<p;e++){d=B[e];d=b.lib.clone(d);if(!c.noalign)for(h in x)d[h]=b.lib.strPad(d[h]||"",x[h]," ",isNaN(b.lib.trim(d[h]).charAt(0))?"right":"left");if(a=d["TMP-VALUE"])d["TMP-VALUE"]=b.fun.color(c.color?"cyan":null,a);if(a=d["TMP-INDEX"])d["TMP-INDEX"]=b.fun.color(c.color?"yellow":null,a);a=b.fun.setDataPattern(c.unit,d,!1);n.stdOut.writeLine(a)}"action"in
c||n.stdOut.writeLine()}if(!(g||"action"in c))try{for(h in e=0,n.stdOut.write("Введите номер действия: "),c.color&&n.stdOut.write(b.fun.color("yellow","",!0)),a=n.stdIn.readLine(),c.color&&n.stdOut.write(b.fun.color("reset","",!0)),a=b.wsh.iconv("cp866","windows-1251",a),a=isNaN(a)?-1:Number(a)-1,m)e++==a&&(c.action=h)}catch(y){try{n.stdOut.writeLine()}catch(C){}g=12}if(!g)if(c.action in m){a=m[c.action];var D=u.expandEnvironmentStrings(a)}else g=13}if(D){if(!g&&c.service)try{var E=A.connectServer(f["NET-HOST"],
"root\\CIMV2")}catch(y){g=14}if(!g&&c.service)try{var z=E.get("Win32_Service.Name='"+c.service+"'");!z.started&&z.startService()&&(g=16)}catch(y){g=15}if(!g)try{u.run(D,1,!c.nowait)}catch(y){g=17}if(!g&&c.service)try{z=E.get("Win32_Service.Name='"+c.service+"'"),z.started&&z.stopService()&&(g=18)}catch(y){g=15}}if(g&&(a={1:"У входящего параметра отсутствует значение.",2:"У параметра с действием отсутствует значение.",3:"Не удалось инициировать получение поискового запроса.",4:"Указан не поддерживаемый режим.",
5:"Обязательные параметры не прошли проверку или отсутствуют.",6:"Задана не допустимая комбинация параметров.",7:"Не удалось получить контейнер для поиска данных.",8:"Не удалось найти подходящие компьютеры.",9:"Не удалось подключиться к локальному компьютеру.",10:"Не удалось инициировать получение номера компьютера.",11:"Отсутствует компьютер с указанным номером.",12:"Не удалось инициировать получение номера действия.",13:"Отсутствует указанное действие.",14:"Не удалось подключиться к удалённому компьютеру.",
15:"Не удалось найти указанную службу на удалённому компьютеру.",16:"Не удалось запустить службу на удалённом компьютере.",17:"Не удалось выполнить комманду действия.",18:"Не удалось остановить службу на удалённом компьютере."}[g])){a=b.fun.color(c.color?"red":null,a);try{n.stdErr.write(a)}catch(y){n.echo(a)}}n.quit(g)}})})(WSH,search);search.init();
